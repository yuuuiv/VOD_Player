<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>VOD Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet" />
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: #000;
            overflow: hidden;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .video-js {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>

    <video
        id="vod-player"
        class="video-js vjs-default-skin vjs-big-play-centered"
        controls
        preload="auto"
        width="1024"
        height="576"
        poster=""
        data-setup='{}'
    >
        <source
            src="https://vod.neofantasy.online/roselia/rose_250215/rose_250215.m3u8"
            type="application/x-mpegURL"
        />
        <p class="vjs-no-js">
            要观看此视频，请启用 JavaScript，并考虑升级到支持 HTML5 视频的浏览器。
        </p>
    </video>

    <script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
    <script src="https://vjs.zencdn.net/8.6.1/videojs-http-streaming.min.js"></script>

    <script>
        // 初始化 Video.js 播放器并加入缓冲区优化配置
        var player = videojs('vod-player', {
            // 确保自动预加载
            preload: 'auto',
            // 自动播放
            autoplay: false,
            
            html5: {
                hls: {
                    // 【性能优化】设置最大缓冲区长度为 60 秒
                    maxBufferLength: 90, 
                    // 【性能优化】设置最大下载缓冲区为 60MB，防止内存溢出
                    maxBufferSize: 90 * 1024 * 1024 
                }
            }
        });

        // 记忆播放进度
        player.ready(function() {
            var savedTime = localStorage.getItem('videoProgress');
            if (savedTime) {
                player.currentTime(parseFloat(savedTime));
            }
            player.on('timeupdate', function() {
                localStorage.setItem('videoProgress', player.currentTime());
            });
        });

        // 键盘快捷键
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space') {
                e.preventDefault();
                if (player.paused()) {
                    player.play();
                } else {
                    player.pause();
                }
            } else if (e.code === 'ArrowLeft') {
                e.preventDefault();
                player.currentTime(Math.max(0, player.currentTime() - 5));
            } else if (e.code === 'ArrowRight') {
                e.preventDefault();
                player.currentTime(player.currentTime() + 5);
            } else if (e.code === 'KeyS') {
                e.preventDefault();
                takeScreenshot();
            }
        });

        // 触摸滑动支持（手机端）
        var startX = 0;
        var endX = 0;
        document.addEventListener('touchstart', function(e) {
            startX = e.touches[0].clientX;
        });
        document.addEventListener('touchend', function(e) {
            endX = e.changedTouches[0].clientX;
            var diff = startX - endX;
            if (Math.abs(diff) > 50) { // 滑动阈值
                if (diff > 0) {
                    // 左滑，快退
                    player.currentTime(Math.max(0, player.currentTime() - 5));
                } else {
                    // 右滑，快进
                    player.currentTime(player.currentTime() + 5);
                }
            }
        });
    </script>

</body>
</html>